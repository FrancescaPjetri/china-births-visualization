<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>China Birth Rates - Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        /* Reset e base per eliminare lo scroll */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f8fafc;
            color: #1f2937;
            height: 100vh; /* Altezza fissa pari alla finestra */
            width: 100vw;
            overflow: hidden; /* Impedisce lo scrolling */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            height: 100%; /* Occupa tutta l'altezza disponibile */
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Header più compatto */
        .header {
            text-align: left;
            border-left: 4px solid #2563eb;
            padding-left: 1rem;
        }

        h1 {
            font-size: 1.5rem; /* Ridotto */
            font-weight: 800;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* Il contenitore del grafico ora è flessibile */
        .chart-container {
            flex-grow: 1; /* Prende tutto lo spazio centrale */
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            position: relative;
            min-height: 0; /* Fondamentale per il flexbox */
        }

        /* Fondamentale per Chart.js in un layout flex */
        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Controlli sulla stessa linea per risparmiare spazio */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        button {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            background: #ffffff;
        }

        .play-btn {
            background: #2563eb;
            color: white;
            border: none;
        }

        /* Stats grid più sottile */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .stat-card {
            background: #ffffff;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .stat-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            color: #6b7280;
            font-weight: 700;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .footer {
            font-size: 0.75rem;
            color: #9ca3af;
            text-align: right;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>China Birth Rates</h1>
            <p class="subtitle">Historical Trends by Gender (1990 - 2023)</p>
        </div>

        <div class="chart-container">
            <canvas id="chartCanvas"></canvas>
        </div>

        <div class="controls">
            <div class="btn-group">
                <button class="play-btn" id="playBtn">▶ Play</button>
                <button id="resetBtn">↺ Reset</button>
            </div>
            <div class="speed-control">
                <label style="font-size: 0.85rem;">Speed: </label>
                <select id="speedSelect" style="padding: 0.2rem;">
                    <option value="slow">Slow</option>
                    <option value="medium" selected>Normal</option>
                    <option value="fast">Fast</option>
                </select>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Year</div>
                <div class="stat-value" id="currentYear">1990</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Male Births</div>
                <div class="stat-value" id="maleValue" style="color: #2563eb;">12.8M</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Female Births</div>
                <div class="stat-value" id="femaleValue" style="color: #db2777;">10.2M</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Gender Ratio</div>
                <div class="stat-value" id="ratioValue">1.25</div>
            </div>
        </div>

        <div class="footer">
            Source: NBS China
        </div>
    </div>

    <script>
        // Dati e logica JS (identica alla tua, ottimizzata per il resize)
        const birthData = [
            { year: 1990, male: 12.8, female: 10.2 },
            { year: 1995, male: 11.5, female: 9.1 },
            { year: 2000, male: 9.8, female: 7.8 },
            { year: 2005, male: 9.2, female: 7.4 },
            { year: 2010, male: 9.5, female: 7.7 },
            { year: 2015, male: 9.3, female: 7.6 },
            { year: 2016, male: 10.1, female: 8.3 },
            { year: 2020, male: 7.2, female: 5.9 },
            { year: 2023, male: 5.2, female: 4.3 }
        ];

        let currentProgress = 0;
        let isPlaying = false;
        let chart = null;
        let lastTimestamp = 0;

        const speedSettings = { slow: 0.0008, medium: 0.0025, fast: 0.006 };
        let currentSpeed = speedSettings.medium;

        function interpolateData(progress) {
            const maxIndex = birthData.length - 1;
            const exactPosition = progress * maxIndex;
            const lowerIndex = Math.floor(exactPosition);
            const upperIndex = Math.min(Math.ceil(exactPosition), maxIndex);
            const fraction = exactPosition - lowerIndex;

            const labels = [];
            const maleData = [];
            const femaleData = [];

            for (let i = 0; i <= lowerIndex; i++) {
                labels.push(birthData[i].year);
                maleData.push(birthData[i].male);
                femaleData.push(birthData[i].female);
            }

            if (fraction > 0 && upperIndex <= maxIndex) {
                const l = birthData[lowerIndex];
                const u = birthData[upperIndex];
                labels.push(Math.round(l.year + (u.year - l.year) * fraction));
                maleData.push(l.male + (u.male - l.male) * fraction);
                femaleData.push(l.female + (u.female - l.female) * fraction);
            }

            return { labels, maleData, femaleData };
        }

        function initChart() {
            const ctx = document.getElementById('chartCanvas').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [birthData[0].year],
                    datasets: [
                        { label: 'Male', data: [birthData[0].male], borderColor: '#2563eb', borderWidth: 3, tension: 0.3, pointRadius: 0 },
                        { label: 'Female', data: [birthData[0].female], borderColor: '#db2777', borderWidth: 3, tension: 0.3, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Permette al grafico di adattarsi al contenitore flex
                    animation: false,
                    plugins: { legend: { position: 'top', labels: { boxWidth: 10, font: { size: 11 } } } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f3f4f6' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateStats(progress) {
            const data = interpolateData(progress);
            const lastM = data.maleData[data.maleData.length - 1];
            const lastF = data.femaleData[data.femaleData.length - 1];
            document.getElementById('currentYear').textContent = data.labels[data.labels.length - 1];
            document.getElementById('maleValue').textContent = lastM.toFixed(1) + 'M';
            document.getElementById('femaleValue').textContent = lastF.toFixed(1) + 'M';
            document.getElementById('ratioValue').textContent = (lastM / lastF).toFixed(2);
        }

        function animate(timestamp) {
            if (!lastTimestamp) lastTimestamp = timestamp;
            const deltaTime = timestamp - lastTimestamp;
            lastTimestamp = timestamp;

            if (isPlaying && currentProgress < 1) {
                currentProgress += currentSpeed * (deltaTime / 16.67);
                currentProgress = Math.min(currentProgress, 1);
                const { labels, maleData, femaleData } = interpolateData(currentProgress);
                chart.data.labels = labels;
                chart.data.datasets[0].data = maleData;
                chart.data.datasets[1].data = femaleData;
                chart.update('none');
                updateStats(currentProgress);

                if (currentProgress < 1) requestAnimationFrame(animate);
                else {
                    isPlaying = false;
                    document.getElementById('playBtn').textContent = '↺ Restart';
                }
            }
        }

        document.getElementById('playBtn').addEventListener('click', () => {
            if (currentProgress >= 1) currentProgress = 0;
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '⏸ Pause' : '▶ Play';
            if (isPlaying) { lastTimestamp = 0; requestAnimationFrame(animate); }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            isPlaying = false;
            currentProgress = 0;
            document.getElementById('playBtn').textContent = '▶ Play';
            chart.data.labels = [birthData[0].year];
            chart.data.datasets[0].data = [birthData[0].male];
            chart.data.datasets[1].data = [birthData[0].female];
            chart.update();
            updateStats(0);
        });

        document.getElementById('speedSelect').addEventListener('change', (e) => {
            currentSpeed = speedSettings[e.target.value];
        });

        initChart();
        updateStats(0);
    </script>
</body>
</html>